<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Batch Nomalization 학습 실제 사용할때 주의 할 점" /><meta name="author" content="KEJdev" /><meta property="og:locale" content="en_US" /><meta name="description" content="오늘은 Batch Nomalization 학습 실제 사용할때 주의 할 점과 가중치 초기화의 중요성에 대해 같이 보도록 하겠습니다." /><meta property="og:description" content="오늘은 Batch Nomalization 학습 실제 사용할때 주의 할 점과 가중치 초기화의 중요성에 대해 같이 보도록 하겠습니다." /><link rel="canonical" href="https://kejdev.github.io/posts/ml-Batch-Nomalization/" /><meta property="og:url" content="https://kejdev.github.io/posts/ml-Batch-Nomalization/" /><meta property="og:site_name" content="🍗 양념치킨 🍗" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-02-01T14:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Batch Nomalization 학습 실제 사용할때 주의 할 점" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"KEJdev"},"dateModified":"2022-08-02T23:27:54+08:00","datePublished":"2020-02-01T14:00:00+08:00","description":"오늘은 Batch Nomalization 학습 실제 사용할때 주의 할 점과 가중치 초기화의 중요성에 대해 같이 보도록 하겠습니다.","headline":"Batch Nomalization 학습 실제 사용할때 주의 할 점","mainEntityOfPage":{"@type":"WebPage","@id":"https://kejdev.github.io/posts/ml-Batch-Nomalization/"},"url":"https://kejdev.github.io/posts/ml-Batch-Nomalization/"}</script><title>Batch Nomalization 학습 실제 사용할때 주의 할 점 | 🍗 양념치킨 🍗</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/favicon.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-148043528-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-148043528-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" style="width:190px" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div style="display:flex"><div id="avatar" style="margin:0 auto 0 auto;"> <a href="/" alt="avatar" class="mx-auto"> <img style="max-width:100%;" src="/assets/img/favicons/mycat.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div></div><div style="display:flex"><div style="margin:0 auto 0 auto; font-weight:550px;" > <a href="/">🍗 양념치킨 🍗</a></div></div><div style="display:flex"><div class="site-subtitle font-italic" style="margin:0 auto 0 auto;">고양이 좋아하는 개발자</div></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post-content" style="margin-top:70px;"><h1 data-toc-skip>Batch Nomalization 학습 실제 사용할때 주의 할 점</h1><div class="post-meta text-muted d-flex flex-column" style="border-bottom:1px solid black;" ><div > <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Feb 1, 2020, 2:00 PM +0800" > Feb 1, 2020 <i class="unloaded">2020-02-01T14:00:00+08:00</i> </span> by <span class="author"> KEJdev </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Aug 3, 2022, 12:27 AM +0900" > Aug 3 <i class="unloaded">2022-08-02T23:27:54+08:00</i> </span> </span></div></div><div class="post-content"><p>오늘은 Batch Nomalization 학습 실제 사용할때 주의 할 점과 가중치 초기화의 중요성에 대해 같이 보도록 하겠습니다.</p><h2 id="가중치-초기화의-중요성">가중치 초기화의 중요성</h2><p>가중치 초기값을 적절하게 설정하면 각 층의 활성화 값의 분포가 적당히 퍼지는 효과가 발생합니다. 그리고 활성화 값이 적절하게 분포하게 되면 학습이 잘되고 정확도가 높아집니다.</p><p>아래의 그림은 학습이 잘 안되는 가중치 분포의 예입니다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets//images/weight1.png" /></p><p>아래의 그림은 학습이 잘된 경우입니다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets//images/weight2.png" /></p><p>한 눈에 봐도 고르게 잘 된것을 알 수 있습니다.</p><h2 id="가중치-초기값-선정하는-5가지-방법">가중치 초기값 선정하는 5가지 방법</h2><p>가중치 초기값을 선정하는 방법에는 대략 5가지 정도가 있습니다.</p><p><strong>1. 가중치 초기값을 0으로 선정.</strong></p><p>이 방법은 추천하지 않습니다. 왜냐하면 학습이 잘되지 않기 때문이죠.<br /> 하지만 이런 방법도 예전에 있는 있었다. 로 넘어가시면 될 것 같습니다.</p><p><strong>2. 표준편차가 1인 정규분포를 사용해 초기값 선정.</strong></p><p>표준편차가 클수룩 Data가 더 많이 흩어져 있습니다. <br /> ex) 시험문제가 어려우면 아주 잘하는 학생들과 아주 못하는 학생들로 점수가 딱 나눠진다.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randm</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets//images/weight3.png" /></p><p><strong>3. 표준편차가 0.01인 정규분포를 사용해 초기값 선정.</strong></p><p>표준편차가 작을수록 Data가 평균에 가깝게 분포합니다. ex) 시험문제가 쉬우면 학생들 점수가 평균에 가깝다.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="mf">0.01</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randm</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets//images/weight4.png" /></p><p><strong>4.Xavier 초기값 선정.</strong></p><p>표준편차가 \(√(1/n)\)인 (n은 앞층의 노드 수) 정규분포로 초기화하는 방법이 있으며 sigmoid 함수와 짝궁이며 같이 사용됩니다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets//images/weight5.png" /></p><p><strong>5.He 초기값 선정.</strong></p><p>표준편차 \(√(2/n)\)인 정규분포로 초기화하는 방법이 있습니다. He는 Relu함수와 짝궁으로 같이 사용됩니다.</p><h2 id="배치-정규화">배치 정규화</h2><p>앞에서 가중치 초기값을 적절하게 설정하면 각 층의 활성화 값이 적절하게 분포하여 학습이 잘되고 정확도가 높아지는 것 또한 알 수 있었습니다.</p><p>그러나 가중치 초기화를 하더라도 가중치 값이 불규칙하게 분포할 가능성이 있습니다. 여기서 배치 정규화의 개념을 툭 튀어나오게 됩니다. <strong>배치 정규화</strong>는 바로 각 층에서 활성화 값이 적당하게 분포 되도록 <strong>강제로</strong> 조정하게 합니다.</p><p>여기서 가장 중요한 사실은 Training data 전체에 대해 mean과 variance를 구하는 것이 아니라, mini batch 단위로 접근하여 계산합니다. 현재 택한 mini batch 안에서만 mean과 variance를 구해서 이 값을 이용해서 mormalize 합니다.</p><p>즉, 학습 시 미니배치를 단위로 정구화를 하며, 데이터 분포가 평균이 0, 분산이 1이 되도록 정규화 합니다.</p>\[{ \mu }_{ B }\quad \leftarrow \frac { 1 }{ m } \sum _{ i=1 }^{ m }{ x_{ i } }\]<p><strong><center>평균</center></strong></p>\[{ \sigma }^{ 2 }_{ B }\quad \leftarrow \frac { 1 }{ m } \sum _{ i=1 }^{ m }{ (x_{ i }- } { \mu }_{ B })^{ { 2 } }\]<p><strong><center>분산</center></strong></p>\[{ \hat { x } }_{ i }\leftarrow \frac { { x }_{ i }-\mu _{ { B } } }{ \sqrt { { \sigma }_{ B }^{ 2 } } +E }\]<p><strong><center>실제 값 - 평균 , 표준편차 + E</center></strong></p><p>왜 층마다 배치 정규화 작업을 해야 할까요? 그 이유는 신경망은 파라미터(매개변수)가 많기 때문에 학습이 어렵습니다. 특히나 딥러닝 같은 경우는 레이어가 많은데 이 뜻은 가중치가 층마다 다르다 라고 해석 할 수 있습니다. 더욱이 층을 통과할수록 각기 다른 가중치가 쌓이며 가중치의 작은 변화가 가중 되어서 쌓이면 레이어가 많아 질수록 출력되는 값의 변화가 크기 때문입니다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets//images/batch1.png" /></p><p>즉, 가중치 때문에 입력값에 대한 완전히 다른 출력값이 나옴을 알 수 있습니다.</p><p>이러한 이유로 배치 정규화가 등장했으며, 배치 정규화는 입력값이 활성화 함수를 통과하기 전에 가중의 변화를 줄이는 것이 목표입니다. 가중의 합이 배치 정규화에 들어오게 되면 기존 값의 스케일을 정규분포로 조정하게 되며 선형이 아닌 비선형 사이로 분포를 유지하여 데이터의 폭(scale), 분포(shift)의 위치를 조절하기 위해 감마(분산)과 베타(평균)을 적용하여 이를 학습하면서 층을 거치게 됩니다.</p><h2 id="batch-normalization-을-사용할-때의-주의할-점">Batch Normalization 을 사용할 때의 주의할 점.</h2><p>배치 정규화를 하는 이유는 학습을 하기 위해서 라고 했습니다. 훈련 데이터를 통해서 이미 감마(분산)값과 베타(평균)값이 이미 최적에 맞춰진 상황입니다. 이 모델을 이용하여 테스트를 수행하려고 할 경우 훈련 데이터의 평군, 표준편차 값과 테스트 데이터의 평균, 표준편차 데이터가 다르기 때문에 제대로 테스트 되지 않을 수 있습니다.</p><p>즉, <strong>훈련 데이터의 최적의 감마, 베타 값을 가지고 테스트를 하면 값이 제대로 나올 수 있기 때문에 테스트 데이터로 모델을 돌릴 때에는 배치 정규화를 사용하면 안됩니다.</strong></p><p>학습 단계에서는 데이터 단위가 배치 단위로 들어오기 때문에 배치의 평균, 분산을 구하는 것이 가능하지만 테스트 단계에서는 배치 단위로 평균/분산을 구하기 어렵습니다. 이를 해결하기 위해서는 두가지 방법이 있습니다.</p><p><strong>1. 학습 단계에서 배치 단위의 평균/ 분산을 저장. (이동평균)</strong> <strong>2. 테스트시에는 구해진 이동평균을 사용하여 정규화.</strong></p><p>Training Data로 학습을 시킬 때는 현재 보고 있는 mini batch에서 평균과 표준 편차를 구하지만, Test Data를 사용하여 Inference를 할 때는 다소 다른 방법을 사용합니다. mini batch의 값들을 이용하는 대신 지금까지 본 전체 데이터를 다 사용한다는 느낌으로, Training할 때 현재까지 본 Input들의 이동평균 및 비편향추정량의 이동평균을 계산하여 저장해놓은 뒤 이 값으로 normalize를 합니다. 마지막에 감마와 베타를 이용하여 scale/shift 해주는 것은 동일합니다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/machine-learning/'>Machine Learning</a>, <a href='/categories/ml/'>ML</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Batch Nomalization 학습 실제 사용할때 주의 할 점 - 🍗 양념치킨 🍗&url=https://kejdev.github.io/posts/ml-Batch-Nomalization/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Batch Nomalization 학습 실제 사용할때 주의 할 점 - 🍗 양념치킨 🍗&u=https://kejdev.github.io/posts/ml-Batch-Nomalization/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Batch Nomalization 학습 실제 사용할때 주의 할 점 - 🍗 양념치킨 🍗&url=https://kejdev.github.io/posts/ml-Batch-Nomalization/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://kejdev.github.io/posts/ml-Batch-Nomalization/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8" style="margin:0 auto; margin-top:25px; max-width: 850px; padding:0px 30px"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div class="post-navigation d-flex justify-content-between"> <a href="/posts/ml-class-softmax/" class="btn btn-outline-primary" prompt="Older"><p>파이썬 클래스로 신경망 구현하기(cross_entropy, softmax, Softmax With loss )</p></a> <a href="/posts/ml-dropout-overfitting/" class="btn btn-outline-primary" prompt="Newer"><p>오버피팅 억제를 위한 방법! Dropout!</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://www.instagram.com/ao_ej125">kejdev</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://kejdev.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
